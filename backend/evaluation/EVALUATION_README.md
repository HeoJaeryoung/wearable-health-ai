# 🧪 AI 웨어러블 헬스케어 평가 시스템

3단계 평가 프레임워크를 통해 Baseline, LangChain, Fine-tuned 모델의 성능을 체계적으로 비교 분석합니다.

---

## 📊 평가 지표 체계 (v2.1)

### 1️⃣ 응답 품질 (Response Quality)

| 지표명            | 측정 방법                           |  범위   | 목적                  |
| ----------------- | ----------------------------------- | :-----: | --------------------- |
| `accuracy`        | 기대 점수 범위 + 키워드 + 등급 매칭 | 0-100%  | 전반적 정확성         |
| `keyword_match`   | 기대 키워드 포함 비율               | 0.0-1.0 | 핵심 내용 포함 여부   |
| `grade_accuracy`  | 기대 등급 vs 실제 등급 일치         | 0-100%  | 건강 상태 판정 정확성 |
| `structure_score` | 필수 필드 포함 여부                 | 0-100%  | 응답 형식 준수        |
| `length_score`    | min~max 범위 내 길이                | 0-100%  | 응답 길이 적절성      |

---

### 2️⃣ 전문성 (Professionalism)

전문성 지표는 **두 가지로 분리**하여 측정합니다:

#### A. 논문 직접 인용 (`citation_strict`) - Fine-tuning 효과 측정용

**저자명을 직접 언급했는지** 확인합니다.

| 지표명                      | 검색 키워드              | 목적                             |
| --------------------------- | ------------------------ | -------------------------------- |
| `buchheit_cited`            | "Buchheit", "부흐하이트" | HRV/심박수 논문 인용             |
| `milewski_cited`            | "Milewski", "밀레브스키" | 수면/부상 논문 인용              |
| `karvonen_cited`            | "Karvonen", "카보넨"     | 운동 강도 공식 인용              |
| `acsm_cited`                | "ACSM"                   | 미국스포츠의학회 가이드라인 인용 |
| **`citation_strict_score`** | 위 4개 종합              | **Fine-tuning 핵심 지표**        |

**예상값:**
| 단계 | 논문 인용율 |
|------|:-----------:|
| Baseline | ~5% |
| LangChain | ~10% |
| **Fine-tuned** | **60%+** |

#### B. 전문 개념 적용 (`concept_score`) - 프롬프트 품질 측정용

**논문의 핵심 개념을 활용했는지** 확인합니다.

| 개념 분류          | 검색 키워드                                                    | 의미                    |
| ------------------ | -------------------------------------------------------------- | ----------------------- |
| `buchheit_concept` | "+10bpm", "피로 신호", "안정시 심박", "과훈련", "HRV 저하"     | 심박수 기반 피로도 판단 |
| `milewski_concept` | "1.7배", "부상 위험", "8시간 미만", "수면 부족", "면역력 저하" | 수면 부족과 부상 연관성 |
| `karvonen_concept` | "목표 심박수", "여유심박수", "HRR", "최대심박수"               | 운동 강도 계산          |
| `acsm_concept`     | "권장량", "가이드라인", "주당 150분", "중강도 유산소"          | 운동 권장 기준          |

**예상값:**
| 단계 | 개념 적용율 |
|------|:-----------:|
| Baseline | ~60-70% |
| LangChain | ~70-80% |
| Fine-tuned | ~85%+ |

---

### 3️⃣ 성능 (Performance)

| 지표명       | 측정 방법      | 단위 | 목적      |
| ------------ | -------------- | :--: | --------- |
| `avg_time`   | 평균 응답 시간 |  초  | API 속도  |
| `avg_tokens` | 평균 토큰 수   |  개  | 비용 추정 |

---

### 4️⃣ 일관성 (Consistency)

| 지표명        | 측정 방법                            |  범위   | 목적   |
| ------------- | ------------------------------------ | :-----: | ------ |
| `consistency` | 동일 입력 N회 실행 시 동일 응답 비율 | 0.0-1.0 | 재현성 |

---

## 📈 서비스별 핵심 지표

| 서비스        | 핵심 지표                                                  | 설명                         |
| ------------- | ---------------------------------------------------------- | ---------------------------- |
| **건강 분석** | `grade_accuracy`, `citation_strict_score`, `concept_score` | 등급 판정 정확성 + 전문 근거 |
| **운동 분석** | `karvonen_cited`, `karvonen_concept_applied`, `accuracy`   | 카보넨 공식 활용             |
| **챗봇**      | `keyword_match`, `length_score`, 캐릭터 톤                 | 적절한 응답 생성             |

---

## 🎯 Fine-tuning 효과 측정

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   Baseline              vs           Fine-tuned             │
│                                                             │
│   📚 citation_strict: 5%    →    📚 citation_strict: 60%+   │
│   💡 concept_score: 70%     →    💡 concept_score: 85%+     │
│                                                             │
│   ─────────────────────────────────────────────────────     │
│                    차이 = Fine-tuning 효과                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**핵심 포인트:**

- `citation_strict_score` 차이가 **Fine-tuning의 진짜 효과**
- `concept_score`는 프롬프트 품질을 반영
- 두 지표 모두 높아야 전문적인 응답

---

## 📁 디렉토리 구조

```
backend/
└── evaluation/
    ├── __init__.py
    ├── config.py                 # 평가 설정
    ├── run_evaluation.py         # 메인 실행 스크립트
    ├── datasets/                 # 테스트 데이터
    │   ├── health_data.json      # 건강 분석 테스트 (58건)
    │   ├── exercise_data.json    # 운동 분석 테스트 (58건)
    │   └── chat_queries.json     # 챗봇 테스트 (40건)
    ├── runners/                  # 평가 실행기
    │   ├── __init__.py
    │   ├── baseline_runner.py    # Baseline (OpenAI SDK)
    │   ├── langchain_runner.py   # LangChain 통합
    │   └── finetuned_runner.py   # Fine-tuned 모델
    ├── metrics/                  # 평가 지표
    │   ├── response_quality.py
    │   ├── performance.py
    │   └── rag_quality.py
    └── results/                  # 평가 결과
        ├── baseline/
        ├── langchain/
        └── finetuned/
```

---

## 🚀 실행 방법

### 1. 개별 단계 실행

```bash
cd backend

# Baseline 평가
python -m evaluation.run_evaluation baseline

# LangChain 평가
python -m evaluation.run_evaluation langchain

# Fine-tuned 평가
python -m evaluation.run_evaluation finetuned
```

### 2. 전체 비교 실행

```bash
python -m evaluation.run_evaluation compare
```

---

## 📊 결과 해석 가이드

### 요약 출력 예시

```
============================================================
📊 Baseline 평가 요약 (v2.1)
============================================================

총 테스트: 156건

[건강 분석] (58건)
   정확도: 45.3%
   키워드 매칭: 0.67
   일관성: 1.00
   응답 시간: 10.28초
   [v2.1 지표]
   응답 구조 점수: 5.8%
   📚 논문 인용율 (저자명): 5.2%      ← Fine-tuning 효과 측정
   💡 개념 적용율: 68.5%              ← 프롬프트 품질 측정
   길이 적절성: 0.0%
   등급 정확도: 15.5%

[운동 분석] (58건)
   정확도: 42.1%
   응답 시간: 8.52초
   [v2.1 지표]
   📚 카보넨 인용율 (저자명): 8.6%    ← Fine-tuning 효과 측정
   💡 카보넨 개념율: 55.2%            ← 프롬프트 품질 측정

[챗봇] (40건)
   정확도: 78.3%
   응답 시간: 14.59초
```

### 결과 JSON 구조

```json
{
  "metadata": {
    "stage": "baseline",
    "version": "v2.1",
    "citation_method": "strict (저자명만) + concept (개념 키워드)"
  },
  "summary": {
    "by_service": {
      "health": {
        "avg_citation_strict_score": 5.2,
        "avg_concept_score": 68.5,
        "grade_accuracy": 15.5
      }
    }
  }
}
```

---

## 🔬 테스트 데이터 기준

### 건강 분석 (6등급 시스템)

| 등급 | 점수 범위 | 라벨                      | 논문 인용 필요 |
| :--: | :-------: | ------------------------- | :------------: |
|  A   |  80-100   | 매우 우수 (optimal)       |       ❌       |
|  B   |   70-79   | 우수 (good)               |       ❌       |
|  C+  |   55-69   | 보통 이상 (moderate_plus) |       ❌       |
|  C   |   45-54   | 보통 (moderate)           |    ⚠️ 선택     |
|  D   |   35-44   | 개선 필요 (caution)       |    ✅ 권장     |
|  F   |   0-34    | 주의 필요 (warning)       |    ✅ 필수     |

### 논문 인용 기준

| 상황               | Buchheit 인용 | Milewski 인용 |
| ------------------ | :-----------: | :-----------: |
| 수면 5시간 미만    |       -       |    ✅ 필요    |
| 심박수 +10bpm 상승 |    ✅ 필요    |       -       |
| 컨디션 D/F 등급    |    ✅ 권장    |    ✅ 권장    |
| 컨디션 A/B 등급    |   ❌ 불필요   |   ❌ 불필요   |

---

## 📚 참고 논문

| 저자                | 주제                | 핵심 내용                                                       |
| ------------------- | ------------------- | --------------------------------------------------------------- |
| **Buchheit (2014)** | HRV와 운동 모니터링 | 안정시 심박수 +10bpm = 피로/과훈련 신호                         |
| **Milewski (2014)** | 수면과 부상 위험    | 8시간 미만 수면 시 부상 위험 1.7배 증가                         |
| **Karvonen (1957)** | 운동 강도 공식      | 목표심박수 = (최대심박수 - 안정시심박수) × 강도% + 안정시심박수 |
| **ACSM**            | 운동 가이드라인     | 주당 150분 중강도 유산소 운동 권장                              |

---

## 🔄 버전 히스토리

| 버전 | 날짜       | 변경 내용                              |
| ---- | ---------- | -------------------------------------- |
| v2.1 | 2026-01-02 | 논문 인용 측정 분리 (strict + concept) |
| v2.0 | 2026-01-02 | 6등급 컨디션 기준, 새 평가 지표 추가   |
| v1.0 | 2026-01-01 | 초기 평가 프레임워크                   |

---

## 📞 문의

프로젝트 관련 문의: AI 웨어러블 헬스케어 팀
