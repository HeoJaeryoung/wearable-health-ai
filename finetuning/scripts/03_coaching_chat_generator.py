"""
LLM Fine-tuning í•™ìŠµ ë°ì´í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸ v2
ì¹´í…Œê³ ë¦¬ 3: ì½”ì¹­ ì±—ë´‡ (500ê±´)

í•µì‹¬ ë³€ê²½ì‚¬í•­:
- 300ê±´ â†’ 500ê±´ìœ¼ë¡œ í™•ëŒ€
- ì§ˆë¬¸ ìœ í˜• ë‹¤ì–‘í™”
- ì‘ë‹µ ê¸¸ì´ ~150ìë¡œ ê°„ê²°í•˜ê²Œ
- ì „ë¬¸ ê¸°ì¤€ ì¸ìš© íŒ¨í„´í™”
"""

import json
import random
from pathlib import Path

# ============================================================
# ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
# ============================================================

SYSTEM_PROMPT = """ë‹¹ì‹ ì€ ìŠ¤í¬ì¸ ì˜í•™ ì§€ì‹ì„ ê°–ì¶˜ ì¹œê·¼í•œ í”¼íŠ¸ë‹ˆìŠ¤ ì½”ì¹˜ì…ë‹ˆë‹¤.

ì—­í• :
- ê±´ê°•/ìš´ë™ ê´€ë ¨ ì§ˆë¬¸ì— ê°„ê²°í•˜ê³  ì‹¤ìš©ì ì¸ ë‹µë³€ ì œê³µ
- í•„ìš”ì‹œ ì „ë¬¸ ì—°êµ¬ ì¸ìš© (Buchheit, Milewski, ACSM)
- ì¹œê·¼í•˜ë©´ì„œë„ ì „ë¬¸ì ì¸ í†¤ ìœ ì§€

ì‘ë‹µ ê·œì¹™:
1. í•µì‹¬ ë‹µë³€ ë¨¼ì € (1-2ë¬¸ì¥)
2. ì‹¤ì²œ ê°€ëŠ¥í•œ ì¡°ì–¸ (1ë¬¸ì¥)
3. ê´€ë ¨ ì—°êµ¬ ì¸ìš© (í•´ë‹¹ ì‹œ)
4. ì´ 3-4ë¬¸ì¥ ì´ë‚´ë¡œ ê°„ê²°í•˜ê²Œ"""


# ============================================================
# ì§ˆë¬¸-ì‘ë‹µ í…œí”Œë¦¿
# ============================================================

QA_TEMPLATES = {
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 1: ìˆ˜ë©´ ê´€ë ¨ (Milewski ì—°êµ¬)
    # ========================================
    "sleep": [
        {
            "questions": [
                "ìˆ˜ë©´ì´ {hours}ì‹œê°„ë°–ì— ì•ˆ ëëŠ”ë° ìš´ë™í•´ë„ ë ê¹Œìš”?",
                "ì–´ì ¯ë°¤ {hours}ì‹œê°„ ì¤ì–´ìš”. ì˜¤ëŠ˜ ìš´ë™ ê´œì°®ì„ê¹Œìš”?",
                "{hours}ì‹œê°„ ìê³  ì¼ì–´ë‚¬ëŠ”ë° ìš´ë™ ê°•ë„ ì–´ë–»ê²Œ í• ê¹Œìš”?",
            ],
            "params": {"hours": [3, 4, 4.5, 5, 5.5]},
            "response_template": """ìˆ˜ë©´ {hours}ì‹œê°„ì€ ë§ì´ ë¶€ì¡±í•´ìš”. 8ì‹œê°„ ë¯¸ë§Œ ìˆ˜ë©´ ì‹œ ë¶€ìƒ ìœ„í—˜ì´ 1.7ë°° ì¦ê°€í•œë‹¤ëŠ” ì—°êµ¬ ê²°ê³¼ê°€ ìˆì–´ìš”.

ğŸ’¡ ì˜¤ëŠ˜ì€ ê³ ê°•ë„ ìš´ë™ì„ í”¼í•˜ê³ , ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­ì´ë‚˜ ì‚°ì±… ì •ë„ë§Œ í•˜ì„¸ìš”. ì˜¤ëŠ˜ ë°¤ ì¶©ë¶„íˆ ìëŠ” ê²Œ ìš°ì„ ì´ì—ìš”!

ğŸ“š ì°¸ê³ : Milewski et al. (2014)""",
        },
        {
            "questions": [
                "7ì‹œê°„ ì¤ëŠ”ë° ì¶©ë¶„í•œê°€ìš”?",
                "ìˆ˜ë©´ 7ì‹œê°„ì´ë©´ ìš´ë™í•´ë„ ë˜ì£ ?",
                "ì–´ì œ 7ì‹œê°„ ì¤ì–´ìš”. ì»¨ë””ì…˜ ê´œì°®ì„ê¹Œìš”?",
            ],
            "response_template": """7ì‹œê°„ì´ë©´ ê¶Œì¥ ë²”ìœ„(7-9ì‹œê°„) ì•ˆì— ë“¤ì–´ìš”! ì¶©ë¶„íˆ íšŒë³µëì„ ê±°ì˜ˆìš”.

ğŸ’¡ í‰ì†Œì²˜ëŸ¼ ìš´ë™í•˜ì…”ë„ ë©ë‹ˆë‹¤. ë‹¤ë§Œ ëª¸ì´ í”¼ê³¤í•˜ë‹¤ë©´ ê°•ë„ë¥¼ ì‚´ì§ ë‚®ì¶°ë³´ì„¸ìš”.""",
        },
        {
            "questions": [
                "8ì‹œê°„ ë„˜ê²Œ ì¤ëŠ”ë° ì™œ í”¼ê³¤í•˜ì£ ?",
                "9ì‹œê°„ ìë„ í”¼ê³¤í•´ìš”. ì™œ ê·¸ëŸ´ê¹Œìš”?",
                "ê³¼ìˆ˜ë©´ì¸ê°€ìš”? ë§ì´ ìë„ í”¼ê³¤í•´ìš”.",
            ],
            "response_template": """ê³¼ìˆ˜ë©´ë„ í”¼ë¡œë¥¼ ìœ ë°œí•  ìˆ˜ ìˆì–´ìš”. ì ì • ìˆ˜ë©´ì€ 7-9ì‹œê°„ì´ê³ , ìˆ˜ë©´ì˜ ì§ˆì´ ë” ì¤‘ìš”í•´ìš”.

ğŸ’¡ ë§¤ì¼ ê°™ì€ ì‹œê°„ì— ìê³  ì¼ì–´ë‚˜ëŠ” ê·œì¹™ì ì¸ ìˆ˜ë©´ íŒ¨í„´ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ê¹Šì€ ìˆ˜ë©´ ë¹„ìœ¨ì´ ë†’ì•„ì§€ë©´ ê°œìš´í•´ì§ˆ ê±°ì˜ˆìš”.""",
        },
        {
            "questions": [
                "ìˆ˜ë©´ì´ ìš´ë™ì— ì™œ ì¤‘ìš”í•œê°€ìš”?",
                "ì ì„ ì˜ ìì•¼ ìš´ë™ íš¨ê³¼ê°€ ì¢‹ë‚˜ìš”?",
                "ìˆ˜ë©´ê³¼ ìš´ë™ì˜ ê´€ê³„ê°€ ë­ì˜ˆìš”?",
            ],
            "response_template": """ìˆ˜ë©´ ì¤‘ì— ê·¼ìœ¡ íšŒë³µê³¼ ì„±ì¥ í˜¸ë¥´ëª¬ ë¶„ë¹„ê°€ ì´ë£¨ì–´ì ¸ìš”. ìˆ˜ë©´ì´ ë¶€ì¡±í•˜ë©´ ìš´ë™ íš¨ê³¼ê°€ ë–¨ì–´ì§€ê³ , ë¶€ìƒ ìœ„í—˜ë„ ë†’ì•„ì ¸ìš”.

ğŸ’¡ ìš´ë™ íš¨ê³¼ë¥¼ ìµœëŒ€í™”í•˜ë ¤ë©´ 7-9ì‹œê°„ ìˆ˜ë©´ì„ ëª©í‘œë¡œ í•˜ì„¸ìš”!

ğŸ“š ì°¸ê³ : Milewski et al. (2014) - 8ì‹œê°„ ë¯¸ë§Œ ìˆ˜ë©´ ì‹œ ë¶€ìƒ ìœ„í—˜ 1.7ë°°""",
        },
    ],
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 2: ì‹¬ë°•ìˆ˜ ê´€ë ¨ (Buchheit ì—°êµ¬)
    # ========================================
    "heart_rate": [
        {
            "questions": [
                "ì•ˆì •ì‹œ ì‹¬ë°•ìˆ˜ê°€ í‰ì†Œë³´ë‹¤ {change}bpm ë†’ì•„ìš”.",
                "RHRì´ +{change}bpmì¸ë° ìš´ë™í•´ë„ ë ê¹Œìš”?",
                "ì˜¤ëŠ˜ ì‹¬ë°•ìˆ˜ê°€ í‰ì†Œë³´ë‹¤ {change} ë†’ì•„ìš”. ê´œì°®ì„ê¹Œìš”?",
            ],
            "params": {"change": [10, 12, 15, 18, 20]},
            "response_template": """ì•ˆì •ì‹œ ì‹¬ë°•ìˆ˜ê°€ í‰ì†Œë³´ë‹¤ +{change}bpm ìƒìŠ¹í–ˆë‹¤ë©´ í”¼ë¡œë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ ì‹ í˜¸ì˜ˆìš”. +10bpm ì´ìƒ ìƒìŠ¹ì€ ê¸‰ì„± í”¼ë¡œë¥¼ ì˜ë¯¸í•´ìš”.

ğŸ’¡ ì˜¤ëŠ˜ì€ íœ´ì‹í•˜ê±°ë‚˜ ì•„ì£¼ ê°€ë²¼ìš´ ìš´ë™ë§Œ í•˜ì„¸ìš”. ë©°ì¹  ì§€ë‚˜ë„ ì•ˆ ëŒì•„ì˜¤ë©´ ë³‘ì› ìƒë‹´ì„ ê¶Œí•´ìš”.

ğŸ“š ì°¸ê³ : Buchheit (2014)""",
        },
        {
            "questions": [
                "RHRì´ ë­ì˜ˆìš”?",
                "ì•ˆì •ì‹œ ì‹¬ë°•ìˆ˜ê°€ ë­”ê°€ìš”?",
                "íœ´ì‹ê¸° ì‹¬ë°•ìˆ˜ëŠ” ì–´ë–»ê²Œ ì¸¡ì •í•´ìš”?",
            ],
            "response_template": """ì•ˆì •ì‹œ ì‹¬ë°•ìˆ˜(RHR)ëŠ” ì™„ì „íˆ íœ´ì‹ ì¤‘ì¼ ë•Œì˜ ì‹¬ë°•ìˆ˜ì˜ˆìš”. ì•„ì¹¨ì— ì¼ì–´ë‚˜ìë§ˆì ì¸¡ì •í•˜ëŠ” ê²Œ ê°€ì¥ ì •í™•í•´ìš”.

ğŸ’¡ ë§¤ì¼ ê°™ì€ ì‹œê°„ì— ì¸¡ì •í•´ì„œ í‰ì†Œ ê°’ì„ ì•Œì•„ë‘ì„¸ìš”. í‰ì†Œë³´ë‹¤ 10bpm ì´ìƒ ë†’ìœ¼ë©´ í”¼ë¡œ ì‹ í˜¸ì˜ˆìš”!""",
        },
        {
            "questions": [
                "ì‹¬ë°•ìˆ˜ê°€ ë‚®ìœ¼ë©´ ì¢‹ì€ ê±´ê°€ìš”?",
                "RHRì´ ë‚®ì„ìˆ˜ë¡ ê±´ê°•í•œ ê±°ì˜ˆìš”?",
                "ì•ˆì •ì‹œ ì‹¬ë°•ìˆ˜ 60ì´ë©´ ì¢‹ì€ í¸ì¸ê°€ìš”?",
            ],
            "response_template": """ë„¤, ì¼ë°˜ì ìœ¼ë¡œ ì•ˆì •ì‹œ ì‹¬ë°•ìˆ˜ê°€ ë‚®ì„ìˆ˜ë¡ ì‹¬ì¥ì´ íš¨ìœ¨ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ê±°ì˜ˆìš”. ìš´ë™ì„ ìˆ˜ëŠ” 50bpm ë¯¸ë§Œì¸ ê²½ìš°ë„ ë§ì•„ìš”.

ğŸ’¡ ê¾¸ì¤€íˆ ìœ ì‚°ì†Œ ìš´ë™ì„ í•˜ë©´ RHRì´ ì ì  ë‚®ì•„ì§ˆ ê±°ì˜ˆìš”!""",
        },
        {
            "questions": [
                "ìš´ë™í•  ë•Œ ì‹¬ë°•ìˆ˜ ì–¼ë§ˆê¹Œì§€ ì˜¬ë ¤ë„ ë˜ë‚˜ìš”?",
                "ìµœëŒ€ ì‹¬ë°•ìˆ˜ëŠ” ì–´ë–»ê²Œ ê³„ì‚°í•´ìš”?",
                "ìš´ë™ ì¤‘ ì ì • ì‹¬ë°•ìˆ˜ê°€ ê¶ê¸ˆí•´ìš”.",
            ],
            "response_template": """ìµœëŒ€ ì‹¬ë°•ìˆ˜ëŠ” '220-ë‚˜ì´'ë¡œ ê³„ì‚°í•´ìš”. ìš´ë™ ê°•ë„ì— ë”°ë¼ ëª©í‘œ ì‹¬ë°•ìˆ˜ê°€ ë‹¬ë¼ì ¸ìš”.

ğŸ’¡ ì¤‘ê°•ë„ ìš´ë™ì€ ìµœëŒ€ ì‹¬ë°•ìˆ˜ì˜ 64-76%, ê³ ê°•ë„ëŠ” 77-95%ë¥¼ ëª©í‘œë¡œ í•˜ì„¸ìš”. ì¹´ë³´ë„¨ ê³µì‹ì„ ì“°ë©´ ë” ì •í™•í•´ìš”!

ğŸ“š ì°¸ê³ : ACSM Guidelines""",
        },
    ],
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 3: ìš´ë™ ê°•ë„/ë°©ë²• (ACSM)
    # ========================================
    "exercise": [
        {
            "questions": [
                "ì¤‘ê°•ë„ ìš´ë™ì´ ë­ì˜ˆìš”?",
                "ì¤‘ê°•ë„ì™€ ê³ ê°•ë„ì˜ ì°¨ì´ê°€ ë­ì˜ˆìš”?",
                "ìš´ë™ ê°•ë„ë¥¼ ì–´ë–»ê²Œ êµ¬ë¶„í•˜ë‚˜ìš”?",
            ],
            "response_template": """ìš´ë™ ê°•ë„ëŠ” ì‹¬ë°•ìˆ˜ë¡œ êµ¬ë¶„í•´ìš”. ì¤‘ê°•ë„ëŠ” ìµœëŒ€ì‹¬ë°•ìˆ˜ì˜ 64-76%, ê³ ê°•ë„ëŠ” 77-95%ì˜ˆìš”.

ğŸ’¡ ì²´ê°ìœ¼ë¡œëŠ” ì¤‘ê°•ë„ëŠ” 'ëŒ€í™”ëŠ” ë˜ì§€ë§Œ ë…¸ë˜ëŠ” ëª» ë¶€ë¥´ëŠ”' ì •ë„, ê³ ê°•ë„ëŠ” 'ëŒ€í™”í•˜ê¸° í˜ë“ ' ì •ë„ì˜ˆìš”!

ğŸ“š ì°¸ê³ : ACSM Guidelines""",
        },
        {
            "questions": [
                "ìœ ì‚°ì†Œë‘ ê·¼ë ¥ ìš´ë™ ìˆœì„œê°€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?",
                "ê·¼ë ¥ ë¨¼ì € í•´ì•¼ í•´ìš”, ìœ ì‚°ì†Œ ë¨¼ì € í•´ì•¼ í•´ìš”?",
                "ìš´ë™ ìˆœì„œê°€ ì¤‘ìš”í•œê°€ìš”?",
            ],
            "response_template": """ëª©í‘œì— ë”°ë¼ ë‹¬ë¼ìš”! ê·¼ë ¥ í–¥ìƒì´ ëª©í‘œë©´ ê·¼ë ¥ ìš´ë™ ë¨¼ì €, ì²´ì¤‘ ê°ëŸ‰ì´ ëª©í‘œë©´ ê·¼ë ¥ â†’ ìœ ì‚°ì†Œ ìˆœì„œê°€ íš¨ê³¼ì ì´ì—ìš”.

ğŸ’¡ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° 'ì›Œë°ì—… â†’ ê·¼ë ¥ â†’ ìœ ì‚°ì†Œ â†’ ì¿¨ë‹¤ìš´' ìˆœì„œë¥¼ ì¶”ì²œí•´ìš”!""",
        },
        {
            "questions": [
                "ì›Œë°ì—… ê¼­ í•´ì•¼ í•˜ë‚˜ìš”?",
                "ìŠ¤íŠ¸ë ˆì¹­ ì•ˆ í•˜ë©´ ì•ˆ ë˜ë‚˜ìš”?",
                "ì›Œë°ì—… ì‹œê°„ì€ ì–¼ë§ˆë‚˜ í•´ì•¼ í•´ìš”?",
            ],
            "response_template": """ë„¤, ì›Œë°ì—…ì€ ë¶€ìƒ ì˜ˆë°©ê³¼ ìš´ë™ íš¨ê³¼ë¥¼ ìœ„í•´ ê¼­ í•„ìš”í•´ìš”! ê·¼ìœ¡ ì˜¨ë„ë¥¼ ì˜¬ë¦¬ê³  ê´€ì ˆ ê°€ë™ì„±ì„ ë†’ì—¬ì¤˜ìš”.

ğŸ’¡ ë³¸ìš´ë™ ì „ 5-10ë¶„ ë™ì  ìŠ¤íŠ¸ë ˆì¹­ì„ í•˜ì„¸ìš”. ì •ì  ìŠ¤íŠ¸ë ˆì¹­ì€ ìš´ë™ í›„ì—!""",
        },
        {
            "questions": [
                "HIITê°€ ë­ì˜ˆìš”?",
                "ì¸í„°ë²Œ ìš´ë™ì´ íš¨ê³¼ ìˆë‚˜ìš”?",
                "ê³ ê°•ë„ ì¸í„°ë²Œ ìš´ë™ ì¶”ì²œí•´ì£¼ì„¸ìš”.",
            ],
            "response_template": """HIITëŠ” ê³ ê°•ë„ ì¸í„°ë²Œ íŠ¸ë ˆì´ë‹ìœ¼ë¡œ, ì§§ì€ ê³ ê°•ë„ ìš´ë™ê³¼ íœ´ì‹ì„ ë°˜ë³µí•˜ëŠ” ê±°ì˜ˆìš”. ì§§ì€ ì‹œê°„ì— ë§ì€ ì¹¼ë¡œë¦¬ë¥¼ ì†Œëª¨í•  ìˆ˜ ìˆì–´ìš”.

ğŸ’¡ 30ì´ˆ ì „ë ¥ ìš´ë™ + 30ì´ˆ íœ´ì‹ì„ 8-10ì„¸íŠ¸ í•´ë³´ì„¸ìš”. ë‹¨, ì»¨ë””ì…˜ì´ ì¢‹ì„ ë•Œë§Œ!""",
        },
        {
            "questions": [
                "ìš´ë™ í›„ ë­˜ ë¨¹ì–´ì•¼ í•´ìš”?",
                "ë‹¨ë°±ì§ˆ ì‰ì´í¬ ê¼­ ë¨¹ì–´ì•¼ í•˜ë‚˜ìš”?",
                "ìš´ë™ í›„ ì‹ì‚¬ëŠ” ì–¸ì œ í•´ì•¼ í•´ìš”?",
            ],
            "response_template": """ìš´ë™ í›„ 30ë¶„-2ì‹œê°„ ë‚´ì— ë‹¨ë°±ì§ˆê³¼ íƒ„ìˆ˜í™”ë¬¼ì„ ì„­ì·¨í•˜ë©´ ì¢‹ì•„ìš”. ë‹¨ë°±ì§ˆ ì‰ì´í¬ëŠ” í•„ìˆ˜ëŠ” ì•„ë‹ˆì—ìš”!

ğŸ’¡ ë‹­ê°€ìŠ´ì‚´+ë°¥, ê·¸ë¦­ìš”ê±°íŠ¸+ê³¼ì¼ ê°™ì€ ì¼ë°˜ ì‹ì‚¬ë¡œë„ ì¶©ë¶„í•´ìš”. í•˜ë£¨ ì´ ë‹¨ë°±ì§ˆ ì„­ì·¨ëŸ‰ì´ ë” ì¤‘ìš”í•´ìš”!""",
        },
    ],
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 4: ì»¨ë””ì…˜/í”¼ë¡œ ê´€ë ¨
    # ========================================
    "condition": [
        {
            "questions": [
                "ì˜¤ëŠ˜ ì»¨ë””ì…˜ì´ ì•ˆ ì¢‹ì€ë° ìš´ë™í•´ì•¼ í• ê¹Œìš”?",
                "í”¼ê³¤í•œë° ìš´ë™í•˜ë©´ ì•ˆ ë˜ë‚˜ìš”?",
                "ëª¸ì´ ì°Œë¿Œë‘¥í•œë° ìš´ë™ ì‰¬ì–´ì•¼ í• ê¹Œìš”?",
            ],
            "response_template": """ì»¨ë””ì…˜ì´ ì•ˆ ì¢‹ìœ¼ë©´ ë¬´ë¦¬í•˜ì§€ ë§ˆì„¸ìš”. 'ì‰¬ëŠ” ê²ƒë„ í›ˆë ¨'ì´ì—ìš”! í”¼ë¡œê°€ ìŒ“ì¸ ìƒíƒœì—ì„œ ìš´ë™í•˜ë©´ ë¶€ìƒ ìœ„í—˜ì´ ë†’ì•„ì ¸ìš”.

ğŸ’¡ ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­ì´ë‚˜ ì‚°ì±… ì •ë„ë§Œ í•˜ê³ , ì˜¤ëŠ˜ì€ ì¼ì° ìì„¸ìš”!""",
        },
        {
            "questions": [
                "ë§¤ì¼ ìš´ë™í•´ë„ ë˜ë‚˜ìš”?",
                "íœ´ì‹ì¼ ì—†ì´ ìš´ë™í•´ë„ ê´œì°®ì•„ìš”?",
                "ì¼ì£¼ì¼ì— ë©°ì¹  ìš´ë™í•´ì•¼ í•´ìš”?",
            ],
            "response_template": """ê°™ì€ ë¶€ìœ„ë¥¼ ë§¤ì¼ ìš´ë™í•˜ëŠ” ê±´ ê¶Œì¥í•˜ì§€ ì•Šì•„ìš”. ê·¼ìœ¡ì€ íœ´ì‹í•  ë•Œ ì„±ì¥í•´ìš”!

ğŸ’¡ ì£¼ 3-5íšŒ ìš´ë™, ì£¼ 1-2íšŒ íœ´ì‹ì„ ê¶Œì¥í•´ìš”. ìš´ë™ ì‹œ ìƒì²´/í•˜ì²´ë¥¼ ë²ˆê°ˆì•„ í•˜ë©´ ë” íš¨ìœ¨ì ì´ì—ìš”.

ğŸ“š ì°¸ê³ : ACSM Guidelines""",
        },
        {
            "questions": [
                "ê·¼ìœ¡í†µì´ ìˆëŠ”ë° ìš´ë™í•´ë„ ë˜ë‚˜ìš”?",
                "ì•Œì´ ë°°ê²¼ëŠ”ë° ìš´ë™í•´ì•¼ í•˜ë‚˜ìš”?",
                "DOMSê°€ ìˆìœ¼ë©´ ì‰¬ì–´ì•¼ í•´ìš”?",
            ],
            "response_template": """ê°€ë²¼ìš´ ê·¼ìœ¡í†µ(DOMS)ì€ ì •ìƒì´ì—ìš”! ë‹¤ë¥¸ ë¶€ìœ„ ìš´ë™ì´ë‚˜ ê°€ë²¼ìš´ ìœ ì‚°ì†ŒëŠ” ì˜¤íˆë ¤ íšŒë³µì— ë„ì›€ì´ ë¼ìš”.

ğŸ’¡ í†µì¦ì´ ì‹¬í•˜ê±°ë‚˜ ê´€ì ˆ í†µì¦ì´ë©´ ì‰¬ì„¸ìš”. ìš´ë™ í›„ ìŠ¤íŠ¸ë ˆì¹­ê³¼ ì¶©ë¶„í•œ ìˆ˜ë©´ì´ íšŒë³µì— ì¤‘ìš”í•´ìš”!""",
        },
    ],
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 5: í™œë™ëŸ‰/ê±¸ìŒìˆ˜ ê´€ë ¨
    # ========================================
    "activity": [
        {
            "questions": [
                "ê±¸ìŒìˆ˜ê°€ {steps}ë³´ë°–ì— ì•ˆ ë¼ìš”.",
                "ì˜¤ëŠ˜ {steps}ë³´ ê±¸ì—ˆëŠ”ë° ì ì€ ê±´ê°€ìš”?",
                "í•˜ë£¨ {steps}ë³´ë©´ ì¶©ë¶„í•œê°€ìš”?",
            ],
            "params": {"steps": [2000, 3000, 4000, 5000]},
            "response_template": """í•˜ë£¨ {steps}ë³´ëŠ” ì¢Œì‹ ìƒí™œ ìˆ˜ì¤€ì´ì—ìš”. ê±´ê°•ì„ ìœ„í•´ ìµœì†Œ 7,000ë³´ ì´ìƒ ê±·ëŠ” ê±¸ ê¶Œì¥í•´ìš”.

ğŸ’¡ ì ì‹¬ í›„ 10ë¶„ ì‚°ì±…, ì—˜ë¦¬ë² ì´í„° ëŒ€ì‹  ê³„ë‹¨ ì´ìš© ë“± ì‘ì€ ìŠµê´€ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”!""",
        },
        {
            "questions": [
                "ë§Œë³´ ê±·ê¸°ê°€ ì •ë§ íš¨ê³¼ ìˆë‚˜ìš”?",
                "í•˜ë£¨ 10000ë³´ ëª©í‘œê°€ ë§ë‚˜ìš”?",
                "ê±·ê¸° ìš´ë™ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•œê°€ìš”?",
            ],
            "response_template": """ë„¤, ê±·ê¸°ëŠ” í›Œë¥­í•œ ìš´ë™ì´ì—ìš”! 10,000ë³´ê°€ ì ˆëŒ€ ê¸°ì¤€ì€ ì•„ë‹ˆì§€ë§Œ, 7,000-10,000ë³´ê°€ ê±´ê°•ì— ì¢‹ë‹¤ëŠ” ì—°êµ¬ê°€ ë§ì•„ìš”.

ğŸ’¡ ì†ë„ë³´ë‹¤ ê¾¸ì¤€í•¨ì´ ì¤‘ìš”í•´ìš”. ë§¤ì¼ 30ë¶„ ë¹ ë¥´ê²Œ ê±·ê¸°ë§Œ í•´ë„ ì¶©ë¶„íˆ íš¨ê³¼ ìˆì–´ìš”!""",
        },
    ],
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 6: ì²´ì¤‘/BMI ê´€ë ¨
    # ========================================
    "weight": [
        {
            "questions": [
                "BMIê°€ {bmi}ì¸ë° ê³¼ì²´ì¤‘ì¸ê°€ìš”?",
                "ì²´ì§ˆëŸ‰ì§€ìˆ˜ {bmi}ì´ë©´ ë¹„ë§Œì¸ê°€ìš”?",
                "BMI {bmi}ëŠ” ì •ìƒ ë²”ìœ„ì˜ˆìš”?",
            ],
            "params": {"bmi": [25, 26, 27, 28]},
            "response_template": """BMI {bmi}ì€ ì•„ì‹œì•„ ê¸°ì¤€ ê³¼ì²´ì¤‘ ë²”ìœ„(23-24.9 ê³¼ì²´ì¤‘, 25+ ë¹„ë§Œ)ì˜ˆìš”. í•˜ì§€ë§Œ BMIë§Œìœ¼ë¡œ ê±´ê°•ì„ íŒë‹¨í•˜ê¸´ ì–´ë ¤ì›Œìš”.

ğŸ’¡ ê·¼ìœ¡ëŸ‰ì´ ë§ìœ¼ë©´ BMIê°€ ë†’ì•„ë„ ê±´ê°•í•  ìˆ˜ ìˆì–´ìš”. ì²´ì§€ë°©ë¥ ê³¼ í—ˆë¦¬ë‘˜ë ˆë„ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”!""",
        },
        {
            "questions": [
                "ì‚´ì´ ì•ˆ ë¹ ì ¸ìš”. ì™œ ê·¸ëŸ´ê¹Œìš”?",
                "ë‹¤ì´ì–´íŠ¸ ì •ì²´ê¸°ì¸ ê²ƒ ê°™ì•„ìš”.",
                "ì²´ì¤‘ ê°ëŸ‰ì´ ì•ˆ ë˜ëŠ” ì´ìœ ê°€ ë­˜ê¹Œìš”?",
            ],
            "response_template": """ë‹¤ì´ì–´íŠ¸ ì •ì²´ê¸°ëŠ” ëˆ„êµ¬ë‚˜ ê²ªì–´ìš”! ëª‡ ê°€ì§€ ì²´í¬í•´ë³´ì„¸ìš”: ìˆ˜ë©´ ì¶©ë¶„í•œê°€ìš”? ë‹¨ë°±ì§ˆ ì„­ì·¨ëŠ”? ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ì—†ë‚˜ìš”?

ğŸ’¡ 2-4ì£¼ ì •ì²´ëŠ” ì •ìƒì´ì—ìš”. ì²´ì¤‘ë³´ë‹¤ ì²´ì§€ë°©ë¥ ê³¼ í—ˆë¦¬ë‘˜ë ˆ ë³€í™”ë¥¼ ë´ì£¼ì„¸ìš”. í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”!""",
        },
    ],
    # ========================================
    # ì¹´í…Œê³ ë¦¬ 7: ì‚°ì†Œí¬í™”ë„ ê´€ë ¨
    # ========================================
    "oxygen": [
        {
            "questions": [
                "ì‚°ì†Œí¬í™”ë„ê°€ {spo2}%ì¸ë° ì •ìƒì¸ê°€ìš”?",
                "SpO2 {spo2}ì´ë©´ ê´œì°®ì€ ê±´ê°€ìš”?",
                "ì‚°ì†Œí¬í™”ë„ {spo2}% ë‚˜ì™”ì–´ìš”.",
            ],
            "params": {"spo2": [93, 94, 95]},
            "response_template": """ì‚°ì†Œí¬í™”ë„ {spo2}%ëŠ” ì •ìƒ ë²”ìœ„(95-100%) ê²½ê³„ì˜ˆìš”. ì¼ì‹œì ì¸ ë³€ë™ì¼ ìˆ˜ ìˆì§€ë§Œ, ì§€ì†ë˜ë©´ í™•ì¸ì´ í•„ìš”í•´ìš”.

ğŸ’¡ ê¹Šì€ í˜¸í¡ì„ ëª‡ ë²ˆ í•˜ê³  ì¬ì¸¡ì •í•´ë³´ì„¸ìš”. ë©°ì¹ ê°„ ê³„ì† ë‚®ìœ¼ë©´ ì˜ë£Œ ìƒë‹´ì„ ê¶Œí•´ìš”.""",
        },
    ],
}


# ============================================================
# ë°ì´í„° ìƒì„± í•¨ìˆ˜
# ============================================================


def generate_qa_pair(template: dict) -> dict:
    """ì§ˆë¬¸-ì‘ë‹µ ìŒ ìƒì„±"""
    # ì§ˆë¬¸ ì„ íƒ
    question = random.choice(template["questions"])
    response = template["response_template"]

    # íŒŒë¼ë¯¸í„° ì¹˜í™˜ (ìˆì„ ê²½ìš°)
    if "params" in template:
        for key, values in template["params"].items():
            value = random.choice(values)
            question = question.replace(f"{{{key}}}", str(value))
            response = response.replace(f"{{{key}}}", str(value))

    return {"question": question, "response": response}


def generate_training_data(total_count: int = 500) -> list:
    """í•™ìŠµ ë°ì´í„° ìƒì„±"""

    # ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë°° (ë¹„ìœ¨)
    category_weights = {
        "sleep": 0.20,  # 100ê±´ - Milewski ì—°êµ¬
        "heart_rate": 0.20,  # 100ê±´ - Buchheit ì—°êµ¬
        "exercise": 0.25,  # 125ê±´ - ACSM ê°€ì´ë“œë¼ì¸
        "condition": 0.15,  # 75ê±´
        "activity": 0.10,  # 50ê±´
        "weight": 0.07,  # 35ê±´
        "oxygen": 0.03,  # 15ê±´
    }

    training_data = []

    for category, weight in category_weights.items():
        count = int(total_count * weight)
        templates = QA_TEMPLATES[category]

        for i in range(count):
            template = random.choice(templates)
            qa = generate_qa_pair(template)

            training_sample = {
                "messages": [
                    {"role": "system", "content": SYSTEM_PROMPT},
                    {"role": "user", "content": qa["question"]},
                    {"role": "assistant", "content": qa["response"]},
                ]
            }

            training_data.append(training_sample)

    # ì„ê¸°
    random.seed(42)
    random.shuffle(training_data)

    return training_data


def save_jsonl(data: list, filepath: str):
    """JSONL í˜•ì‹ìœ¼ë¡œ ì €ì¥"""
    with open(filepath, "w", encoding="utf-8") as f:
        for item in data:
            f.write(json.dumps(item, ensure_ascii=False) + "\n")


# ============================================================
# ë©”ì¸ ì‹¤í–‰
# ============================================================

if __name__ == "__main__":
    print("=" * 60)
    print("ğŸ’¬ ì½”ì¹­ ì±—ë´‡ í•™ìŠµ ë°ì´í„° ìƒì„± v2")
    print("=" * 60)
    print("ğŸ“‹ ë³€ê²½ì‚¬í•­:")
    print("   - 300ê±´ â†’ 500ê±´ìœ¼ë¡œ í™•ëŒ€")
    print("   - 7ê°œ ì¹´í…Œê³ ë¦¬ ì§ˆë¬¸ ìœ í˜•")
    print("   - ì‘ë‹µ ê¸¸ì´ ~150ìë¡œ ê°„ê²°í•˜ê²Œ")
    print("   - ì „ë¬¸ ê¸°ì¤€ ì¸ìš© íŒ¨í„´í™”")
    print()

    training_data = generate_training_data(500)

    output_dir = Path(__file__).parent.parent / "data"
    output_dir.mkdir(parents=True, exist_ok=True)

    output_file = output_dir / "coaching_chat_data_v2.jsonl"
    save_jsonl(training_data, output_file)

    print(f"âœ… ìƒì„± ì™„ë£Œ: {len(training_data)}ê±´")
    print(f"ğŸ“ ì €ì¥ ìœ„ì¹˜: {output_file}")

    # ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬ ì¶œë ¥
    print("\nğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬:")
    for category, weight in [
        ("sleep", 0.20),
        ("heart_rate", 0.20),
        ("exercise", 0.25),
        ("condition", 0.15),
        ("activity", 0.10),
        ("weight", 0.07),
        ("oxygen", 0.03),
    ]:
        print(f"   - {category}: {int(500 * weight)}ê±´")

    # ìƒ˜í”Œ ì¶œë ¥
    print("\n" + "=" * 60)
    print("ğŸ“ ìƒ˜í”Œ ì‘ë‹µ:")
    print("=" * 60)
    sample = training_data[0]
    print(f"\n[User]\n{sample['messages'][1]['content']}")
    print(f"\n[Assistant]\n{sample['messages'][2]['content']}")
