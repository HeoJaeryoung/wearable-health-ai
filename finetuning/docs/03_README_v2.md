# Fine-tuning í•™ìŠµ ë°ì´í„° README v2

## ğŸ“‹ ê°œìš”

ì›¨ì–´ëŸ¬ë¸” ìƒì²´ ë°ì´í„° ê¸°ë°˜ ê±´ê°•/ìš´ë™ ë¶„ì„ì„ ìœ„í•œ LLM Fine-tuning í•™ìŠµ ë°ì´í„°ì…ë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ì»¨ì…‰

> **"ì¼ê´€ëœ ì „ë¬¸ê°€ ì‘ë‹µ í˜•ì‹ê³¼ íŒë‹¨ íŒ¨í„´ì„ í•™ìŠµì‹œì¼œ ì‘ë‹µ í’ˆì§ˆì„ í‘œì¤€í™”í•œë‹¤"**

| í•™ìŠµ ëŒ€ìƒ       | ì„¤ëª…                | ì˜ˆì‹œ                           |
| --------------- | ------------------- | ------------------------------ |
| **ì‘ë‹µ í˜•ì‹**   | ì¼ê´€ëœ êµ¬ì¡°ì™€ í¬ë§·  | ë§ˆí¬ë‹¤ìš´ í‘œ, ì„¹ì…˜ êµ¬ì¡°, ì´ëª¨ì§€ |
| **íŒë‹¨ íŒ¨í„´**   | ì…ë ¥ â†’ íŒë‹¨ ê·œì¹™    | "RHR +10bpm â†’ íœ´ì‹ ê¶Œì¥"       |
| **ì¸ìš© ìŠ¤íƒ€ì¼** | ì „ë¬¸ ê·¼ê±° ì–¸ê¸‰ ë°©ì‹ | "(Buchheit, 2014)"             |
| **í†¤/í˜ë¥´ì†Œë‚˜** | ì¹œê·¼í•œ ì „ë¬¸ê°€ ë§íˆ¬  | "~í•´ìš”", "~ë“œë ¤ìš”"             |

---

## ğŸ“Š ë°ì´í„° êµ¬ì„±

| í•­ëª©      | ë‚´ìš©                            |
| --------- | ------------------------------- |
| ì´ ë°ì´í„° | 1,500ê±´                         |
| Train     | 1,200ê±´ (80%) - í•™ìŠµìš©          |
| Valid     | 150ê±´ (10%) - í•™ìŠµ ì¤‘ ê²€ì¦      |
| Test      | 150ê±´ (10%) - í•™ìŠµ í›„ ëª¨ë¸ í‰ê°€ |
| í˜•ì‹      | JSONL (OpenAI Chat Format)      |

### ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬

| ì¹´í…Œê³ ë¦¬      | ê±´ìˆ˜  | ë¹„ìœ¨ | ëª©ì                            |
| ------------- | :---: | :--: | ------------------------------ |
| ê±´ê°• ë¶„ì„     | 400ê±´ | 27%  | ìƒì²´ ë°ì´í„° â†’ ê±´ê°• ìƒíƒœ í•´ì„   |
| ìš´ë™ ë¶„ì„     | 300ê±´ | 20%  | ë£¨í‹´ ì í•©ë„ í‰ê°€ + ì¹´ë³´ë„¨ ê³µì‹ |
| ì½”ì¹­ ì±—ë´‡     | 500ê±´ | 33%  | ê±´ê°•/ìš´ë™ ê´€ë ¨ Q&A             |
| **íŒë‹¨ íŒ¨í„´** | 300ê±´ | 20%  | ëª…ì‹œì  íŒë‹¨ ê·¼ê±° í•™ìŠµ (ì‹ ê·œ)   |

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
finetuning_v2/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ 01_health_interpretation_generator_v2.py  # ê±´ê°• ë¶„ì„ (400ê±´)
â”‚   â”œâ”€â”€ 02_exercise_analysis_generator_v2.py      # ìš´ë™ ë¶„ì„ (300ê±´)
â”‚   â”œâ”€â”€ 03_coaching_chat_generator_v2.py          # ì½”ì¹­ ì±—ë´‡ (500ê±´)
â”‚   â”œâ”€â”€ 04_decision_pattern_generator.py          # íŒë‹¨ íŒ¨í„´ (300ê±´) â˜…ì‹ ê·œ
â”‚   â””â”€â”€ 05_merge_and_split.py                     # í†µí•© ë° ë¶„í• 
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ health_interpretation_data_v2.jsonl
â”‚   â”œâ”€â”€ exercise_analysis_data_v2.jsonl
â”‚   â”œâ”€â”€ coaching_chat_data_v2.jsonl
â”‚   â”œâ”€â”€ decision_pattern_data_v2.jsonl
â”‚   â”œâ”€â”€ train_YYYYMMDD.jsonl                      # í•™ìŠµ ë°ì´í„° (1,200ê±´)
â”‚   â”œâ”€â”€ valid_YYYYMMDD.jsonl                      # ê²€ì¦ ë°ì´í„° (150ê±´)
â”‚   â”œâ”€â”€ test_model_YYYYMMDD.jsonl                 # ëª¨ë¸ í‰ê°€ ë°ì´í„° (150ê±´)
â”‚   â””â”€â”€ stats_YYYYMMDD.json                       # í†µê³„
â””â”€â”€ docs/
    â”œâ”€â”€ 01_LLM_Finetuning_ê³„íšì„œ_v2.md
    â”œâ”€â”€ 02_ì „ë¬¸ê¸°ì¤€_ì •ë¦¬.md
    â””â”€â”€ 03_README_v2.md
```

---

## ğŸ“ ì‘ë‹µ í˜•ì‹ (v2 ê°„ì†Œí™”)

### v1 â†’ v2 ë³€ê²½

| í•­ëª©                |   v1   |     v2     |
| ------------------- | :----: | :--------: |
| ê±´ê°• ë¶„ì„ ì‘ë‹µ ê¸¸ì´ | ~500ì | **~200ì** |
| ìš´ë™ ë¶„ì„ ì‘ë‹µ ê¸¸ì´ | ~600ì | **~250ì** |
| ì±—ë´‡ ì‘ë‹µ ê¸¸ì´      | ~300ì | **~150ì** |
| íŒë‹¨ ê·¼ê±°           | ì•”ë¬µì  | **ëª…ì‹œì ** |

### ê±´ê°• ë¶„ì„ ì‘ë‹µ ì˜ˆì‹œ

```markdown
âœ… **ì»¨ë””ì…˜: ì–‘í˜¸** (75/100)

**íŒë‹¨ ê·¼ê±°:**

- ìˆ˜ë©´ 7.5ì‹œê°„ (ê¶Œì¥ëŸ‰ 7-9ì‹œê°„ ì¶©ì¡±) âœ…
- ì•ˆì •ì‹œ ì‹¬ë°• 65bpm (í‰ì†Œ ëŒ€ë¹„ +2bpm) âœ…
- í™œë™ëŸ‰ 8,500ë³´ âœ…

ğŸ’¡ **ì˜¤ëŠ˜ì˜ ê¶Œì¥:** ì¤‘-ê³ ê°•ë„ ìš´ë™ ê°€ëŠ¥
```

### íŒë‹¨ íŒ¨í„´ ì‘ë‹µ ì˜ˆì‹œ (ì‹ ê·œ)

```markdown
ğŸš¨ **ê²½ê³  ìƒíƒœ**

**íŒë‹¨ ê·¼ê±°:**

1. ìˆ˜ë©´ 4.5ì‹œê°„ â†’ ë¶€ìƒ ìœ„í—˜ 1.7ë°° (Milewski, 2014)
2. RHR +13bpm â†’ ê¸‰ì„± í”¼ë¡œ ì‹ í˜¸ (Buchheit, 2014)

ğŸ’¡ **ê¶Œì¥:** ì˜¤ëŠ˜ì€ ë°˜ë“œì‹œ íœ´ì‹í•˜ì„¸ìš”.
```

---

## ğŸ“Š ì…ë ¥ ë°ì´í„° ìŠ¤í‚¤ë§ˆ

### 9ê°€ì§€ ìƒì²´ ë°ì´í„°

| í•„ë“œëª…               | íƒ€ì…  | ë‹¨ìœ„ | íŒë‹¨ ê¸°ì¤€                    |
| -------------------- | ----- | ---- | ---------------------------- |
| `heart_rate`         | int   | bpm  | 60-100 ì •ìƒ                  |
| `resting_heart_rate` | int   | bpm  | í‰ì†Œ ëŒ€ë¹„ +10bpm â†’ í”¼ë¡œ ì‹ í˜¸ |
| `sleep_hr`           | float | ì‹œê°„ | 7-9ì‹œê°„ ê¶Œì¥, <6ì‹œê°„ ë¶€ì¡±    |
| `steps`              | int   | ë³´   | 7,000+ ê¶Œì¥                  |
| `distance_km`        | float | km   | 5km+ ì–‘í˜¸                    |
| `active_calories`    | int   | kcal | 300+ ì–‘í˜¸                    |
| `oxygen_saturation`  | int   | %    | 95%+ ì •ìƒ                    |
| `weight`             | float | kg   | ì°¸ì¡°ìš©                       |
| `bmi`                | float | -    | 18.5-24.9 ì •ìƒ               |

### JSONL í˜•ì‹

```json
{
  "messages": [
    { "role": "system", "content": "ë‹¹ì‹ ì€ ìŠ¤í¬ì¸ ì˜í•™ ì „ë¬¸ê°€ì…ë‹ˆë‹¤..." },
    {
      "role": "user",
      "content": "ë‚˜ì´: 35ì„¸, ì„±ë³„: ë‚¨ì„±\nresting_heart_rate: 78bpm (í‰ì†Œ 65bpm, +13)..."
    },
    {
      "role": "assistant",
      "content": "ğŸš¨ **ê²½ê³  ìƒíƒœ**\n\n**íŒë‹¨ ê·¼ê±°:**\n1. RHR +13bpm â†’ ê¸‰ì„± í”¼ë¡œ ì‹ í˜¸..."
    }
  ]
}
```

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ì„¤ì •

```bash
cd wearable_backend/finetuning_v2/scripts
```

### 2. ë°ì´í„° ìƒì„±

```bash
# ê°œë³„ ì‹¤í–‰
python 01_health_interpretation_generator_v2.py
python 02_exercise_analysis_generator_v2.py
python 03_coaching_chat_generator_v2.py
python 04_decision_pattern_generator.py
python 05_merge_and_split.py

# ë˜ëŠ” ìˆœì°¨ ì‹¤í–‰
python 01_health_interpretation_generator_v2.py && \
python 02_exercise_analysis_generator_v2.py && \
python 03_coaching_chat_generator_v2.py && \
python 04_decision_pattern_generator.py && \
python 05_merge_and_split.py
```

### 3. ì¶œë ¥ íŒŒì¼

| íŒŒì¼                        | ìš©ë„                         |
| --------------------------- | ---------------------------- |
| `train_YYYYMMDD.jsonl`      | Azure Fine-tuning í•™ìŠµ       |
| `valid_YYYYMMDD.jsonl`      | í•™ìŠµ ì¤‘ ê²€ì¦ (Loss ëª¨ë‹ˆí„°ë§) |
| `test_model_YYYYMMDD.jsonl` | í•™ìŠµ í›„ ëª¨ë¸ í‰ê°€            |

---

## â˜ï¸ Azure AI Foundry ì—…ë¡œë“œ

### 1. ì ‘ì†

- [Azure AI Foundry](https://ai.azure.com/) ì ‘ì†
- í”„ë¡œì íŠ¸ ì„ íƒ ë˜ëŠ” ìƒì„±

### 2. ë°ì´í„° ì—…ë¡œë“œ

1. **Fine-tuning** ë©”ë‰´ ì„ íƒ
2. **+ Create** í´ë¦­
3. Base Model: **Llama 3.1 8B Instruct** ì„ íƒ
4. Training data: `train_YYYYMMDD.jsonl` ì—…ë¡œë“œ
5. Validation data: `valid_YYYYMMDD.jsonl` ì—…ë¡œë“œ

### 3. í•˜ì´í¼íŒŒë¼ë¯¸í„° ì„¤ì •

| íŒŒë¼ë¯¸í„°      | ê¶Œì¥ê°’ |
| ------------- | :----: |
| Epochs        |   3    |
| Batch Size    |   4    |
| Learning Rate |  2e-4  |
| LoRA Rank     |   16   |
| LoRA Alpha    |   32   |

### 4. ì‹¤í–‰

- **Submit** í´ë¦­
- ì˜ˆìƒ ì†Œìš” ì‹œê°„: 1-3ì‹œê°„
- ì™„ë£Œ í›„ ëª¨ë¸ ì—”ë“œí¬ì¸íŠ¸ ìƒì„±

---

## ğŸ“ˆ í‰ê°€ ì²´ê³„

### ë‘ ê°€ì§€ í‰ê°€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ëª¨ë¸ í‰ê°€ (test_model_*.jsonl, 150ê±´)                   â”‚
â”‚     - Fine-tuned ëª¨ë¸ì˜ í•™ìŠµ í’ˆì§ˆ ì¸¡ì •                      â”‚
â”‚     - ì •ë‹µ(assistant)ê³¼ ì‹¤ì œ ì¶œë ¥ ë¹„êµ                      â”‚
â”‚     - Train/Validì™€ ë™ì¼í•œ í˜•ì‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. ì„œë¹„ìŠ¤ í‰ê°€ (evaluation/datasets/, 100ê±´)               â”‚
â”‚     - Baseline â†’ LangChain â†’ Fine-tuned 3ë‹¨ê³„ ë¹„êµ         â”‚
â”‚     - ì¶œë ¥ í’ˆì§ˆ ì§€í‘œ: í‚¤ì›Œë“œ ë§¤ì¹­, ì¸ìš©ìœ¨, í†¤ ë“±            â”‚
â”‚     - ìƒì²´ ë°ì´í„° 60ê±´ + ì±—ë´‡ 40ê±´                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë¹„ìŠ¤ í‰ê°€ ì§€í‘œ

| ì§€í‘œ               | ì¸¡ì • ë°©ë²•              | Baseline ì˜ˆìƒ | Fine-tuned ëª©í‘œ |
| ------------------ | ---------------------- | :-----------: | :-------------: |
| ì‘ë‹µ êµ¬ì¡° ì¼ì¹˜ìœ¨   | í•„ìˆ˜ ì„¹ì…˜ í¬í•¨ ì—¬ë¶€    |      60%      |    **95%+**     |
| ì»¨ë””ì…˜ ë“±ê¸‰ ì •í™•ë„ | ì…ë ¥ â†’ ì˜¬ë°”ë¥¸ ë“±ê¸‰     |      70%      |    **95%+**     |
| ì „ë¬¸ ê¸°ì¤€ ì¸ìš©ìœ¨   | Buchheit/Milewski ì¸ìš© |      20%      |    **80%+**     |
| ì‘ë‹µ ê¸¸ì´ ì ì ˆì„±   | ëª©í‘œ ë²”ìœ„ ë‚´           |      50%      |    **85%+**     |

---

## ğŸ”§ wearable_backend í†µí•©

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```env
# .env
AZURE_FINETUNED_ENDPOINT=https://your-endpoint.azure.com
AZURE_FINETUNED_API_KEY=your-api-key
AZURE_FINETUNED_MODEL_NAME=your-model-name
```

### 2. API í˜¸ì¶œ ì˜ˆì‹œ

```python
import os
import requests

def call_finetuned_model(health_data: dict) -> str:
    endpoint = os.getenv("AZURE_FINETUNED_ENDPOINT")
    api_key = os.getenv("AZURE_FINETUNED_API_KEY")

    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    }

    payload = {
        "messages": [
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": format_health_data(health_data)}
        ]
    }

    response = requests.post(endpoint, headers=headers, json=payload)
    return response.json()["choices"][0]["message"]["content"]
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„° ìƒì„±

- [x] ê±´ê°• ë¶„ì„ (400ê±´)
- [x] ìš´ë™ ë¶„ì„ (300ê±´)
- [x] ì½”ì¹­ ì±—ë´‡ (500ê±´)
- [x] íŒë‹¨ íŒ¨í„´ (300ê±´) â˜…ì‹ ê·œ
- [x] Train/Valid/Test ë¶„í•  (80/10/10)

### ì„œë¹„ìŠ¤ í‰ê°€ ë°ì´í„°

- [x] ìƒì²´ ë°ì´í„° (60ê±´)
- [x] ì±—ë´‡ ì§ˆë¬¸ (40ê±´)

### Azure ì—…ë¡œë“œ (ì˜ˆì •)

- [ ] train_YYYYMMDD.jsonl ì—…ë¡œë“œ
- [ ] valid_YYYYMMDD.jsonl ì—…ë¡œë“œ
- [ ] Fine-tuning Job ìƒì„±
- [ ] ëª¨ë¸ ë°°í¬

### í‰ê°€ (ì˜ˆì •)

- [ ] ëª¨ë¸ í‰ê°€ (test*model*\*.jsonl)
- [ ] ì„œë¹„ìŠ¤ í‰ê°€ (3ë‹¨ê³„ ë¹„êµ)
- [ ] ê²°ê³¼ ë¬¸ì„œí™”

---

## ğŸ“š ì ìš© ì „ë¬¸ ê¸°ì¤€

| ê¸°ì¤€                 | ì¶œì²˜                   | ì ìš©                         |
| -------------------- | ---------------------- | ---------------------------- |
| ìš´ë™ ì²˜ë°© ê°€ì´ë“œë¼ì¸ | ACSM                   | ìš´ë™ ê°•ë„ ë¶„ë¥˜, ê¶Œì¥ëŸ‰       |
| í”¼ë¡œ/ê³¼í›ˆë ¨ íŒë‹¨     | Buchheit (2014)        | RHR +10bpm ì´ìƒ â†’ í”¼ë¡œ ì‹ í˜¸  |
| ìˆ˜ë©´ê³¼ ë¶€ìƒ ìœ„í—˜     | Milewski et al. (2014) | 8ì‹œê°„ ë¯¸ë§Œ â†’ ë¶€ìƒ ìœ„í—˜ 1.7ë°° |
| ëª©í‘œ ì‹¬ë°•ìˆ˜ ê³„ì‚°     | ì¹´ë³´ë„¨ ê³µì‹            | (220-ë‚˜ì´-RHR)Ã—ê°•ë„%+RHR     |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Azure AI Foundry ë¬¸ì„œ](https://learn.microsoft.com/azure/ai-studio/)
- [Llama 3.1 Fine-tuning ê°€ì´ë“œ](https://ai.meta.com/llama/)
- [ACSM Guidelines](https://www.acsm.org/)
- Buchheit, M. (2014). Monitoring training status with HR measures
- Milewski, M. D., et al. (2014). Chronic lack of sleep is associated with increased sports injuries
